var planets, running, chooseXY;

function setup() {
    var holder = select("#holder");
    createCanvas(holder.width, holder.height).parent('holder');
    planets = [];
    running = false;
    chooseXY = false;
}

function draw() {
    background(50);
    if (running)
	update();
    planets.forEach(function (planet) {
	planet.draw();
    });
}

function update() {
    planets.forEach(function(p) {
	planets.forEach(function(p2) {
	    if (p != p2)
		p.gravitate(p2);
	});
    });
}

function mouseClicked() {
    if (chooseXY) {
	if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
	    var x = mouseX,
	    y = mouseY,
	    mass = document.getElementByTagName("massInput").value,
	    radius = document.getElementByTagName("radiusInput").value,
	    fixed = document.getElementByTagName("fixedInput").value;
	    planets.push(createPlanet(x, y, mass, radius, fixed));
	}
    }	
}

function createPlanet(nx, ny, nmass, nradius, nfixed) {
    return {
	x : nx,
	y : ny,
	vx : 0,
	vy : 0,
	mass : nmass,
	radius : nradius,
	fixed : nfixed,
	r : (Math.random()*150+50),
	g : (Math.random()*150+50),
	b : (Math.random()*150+50),
	move : function () {
	    x += vx;
	    y += vy;
	},
	draw : function () {
	    fill(r, g, b);
	    ellipse(x, y, radius, radius);
	},
	gravitate : function (p) {
	    var m = mass*p.mass,
	    d = dist(x, y, p.x, p.y),
	    g = m/(d*d),
	    deltax = x - p.x,
	    deltay = y - p.y;
	    vx -= g*deltax/d/10000;
	    vy -= g*deltay/d/10000;

	    if (dist(x, y, p.x, p.y) <= radius + p.radius) {
		x -= dx;
		y -= dy;
		dx *= -.4;
		dy *= -.4;
	    }
	    
	}
    };
}

function setPbutton() {
    var button = document.getElementById("pbutton");
    if (running) {
	button.innerHTML = "Pause";
	button.setAttribute("onclick", "pause()");
    } else {
	button.innerHTML = "Play";
	button.setAttribute("onclick", "play()");
    }
}

function play() {
    running = true;
    setPbutton();
}

function pause() {
    running = false;
    setPbutton();
}
